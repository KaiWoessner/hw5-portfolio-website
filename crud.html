<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Kainoa Woessner's Portfolio - Projects</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body>

    <!-- top bar with gear and navigation -->
    <header>
        <!-- Settings button -->
        <button id="settings-button" popovertarget="settings-dialog" popovertargetaction="show">
          <i class="fa fa-gear"></i>
        </button>

        <!-- Navigate to other pages -->
        <nav>
          <a href="about.html"><b>About</b></a>
          <a href="experience.html"><b>Experience</b></a>
          <a href="project.html"><b>Projects</b></a>
        </nav>
  </header>
  
    <!-- Main content section -->
    <main>
        <!-- Static information sidebar  -->
        <section id="sidebar-section">
            <!-- Personal Information -->
            <picture>
                <source srcset="resources/profile-pic/profile-pic-150x155.png" media="(max-width: 900px)">
                <img src="resources/profile-pic/profile-pic-320x320.png" alt="Profile photo">
            </picture>  
            <!-- Text information -->
            <div id="text-info"> 
                <h2> Kainoa Woessner</h2>
                <p>4th year Computer Engineering Student at UC San Diego</p>
            </div>

            <!-- Links -->
            <nav id="media-links">
                <ul>
                <li>
                    <a href="mailto:kainoawoessner@gmail.com">
                    <i class="fa fa-envelope"><span>Email</span></i>
                    </a>
                </li>
                <li>
                    <a href="https://github.com/KaiWoessner">
                    <i class="fa fa-github"><span>GitHub</span></i>
                    </a>
                </li>
                <li>
                    <a href="https://www.linkedin.com/in/kainoawoessner/">
                    <i class="fa fa-linkedin"><span>LinkedIn</span></i>
                    </a>
                </li>
                <li>
                    <a href="resources/kainoa-woessner-resume.pdf">
                    <i class="fa fa-file"><span>Resume</span></i>
                    </a>
                </li>
                </ul>
            </nav>
        </section>


        <!-- List of projects -->
        <section id="project-section">
            <div id="project-header">
                <h1>Projects</h1>
                <div id="storage-buttons">
                    <button id="new-project-btn">New Project</button>
                    <button id="load-local">Load Local</button>
                    <!-- <button id="load-remote">Load Remote</button> -->
                </div>
            </div>

            <slot id="project-container"></slot>
        </section>
      </main>
  
    <!-- Footer -->
    <footer>
      <p>&copy; <span>2025</span> Kainoa Woessner</p>
    </footer>

    <!-- Project dialog -->
    <dialog id="project-dialog">
        <h2>New Project</h2>
        <form id="project-form" method="dialog">
            <label>Title:<br>
                <input type="text" id="project-title" name="title" required>
            </label><br><br>
    
            <label>Image URL:<br>
                <input type="text" id="project-image" name="image" required>
            </label><br><br>
    
            <label>Alt Text:<br>
                <input type="text" id="project-alt" name="alt">
            </label><br><br>
    
            <label>Skills (separate with comma):<br>
                <input type="text" id="project-skills" name="skills">
            </label><br><br>
    
            <label>Description:<br>
                <textarea id="project-description" rows="4" name="description"></textarea>
            </label><br><br>
    
            <label>Link:<br>
                <input type="text" id="project-link" name="link">
            </label><br><br>
    
            <button id="save-project-btn">Save Project</button>
        </form>
    </dialog>
  
    <!-- Settings dialog -->
    <dialog id="settings-dialog" popover>

        <!-- Light/Dark Mode -->
        <h2>Theme</h2>
        <label class="switch">
        <input type="checkbox" id="theme-toggle">
        <span class="slider"></span>
        <span class="switch-label">Mode</span>
        </label>

        <button popovertarget="settings-dialog" popovertargetaction="hide">Close</button>
    </dialog>

    <script>
        let currentEditingCard = null;

        // Get project data from JSONBin
        async function fetchProjects() {
            const res = await fetch("https://api.jsonbin.io/v3/b/69278690d0ea881f40024b33/latest", {
              headers: {
                "X-Master-Key": "$2a$10$BDP6g3oiIozClCcOCjYqt.cTnqybdTvVoRTQvqlZWwtkCB/J4XYSO"
              }
            });
          
            const data = await res.json();
            return data.record;
          }

        // Create project-card custom element
        class ProjectCard extends HTMLElement {
            constructor() {
                super();
                this.attachShadow({ mode: 'open' });
            }
    
            connectedCallback() {
                const title = this.getAttribute('title') || '';
                const image = this.getAttribute('image') || '';
                const imageSmall = this.getAttribute('image-small') || '';
                const alt = this.getAttribute('alt') || '';
                const skills = this.getAttribute('skills') || '';
                const description = this.getAttribute('description') || '';
                const link = this.getAttribute('link') || '#';
        
                // Directly insert HTML and CSS here
                this.shadowRoot.innerHTML = `
                    <style>
                        :root {
                            --dark-color: #2C3E50;  
                            --button-hover-color: color(display-p3 0.59 0.89 0.83);    
                            --text-hover-color: color-mix(in srgb, var(--text-color) 20%, #04715b 80%);
                            --background-color: #f5f5f5;
                            --bar-color: #dcdcdc;
                            --bar-border-color: #ccc;
                            --text-color: #2c2c2c;
                            --button-color: #f3f3f3;
                            --border-color: #000000;
                            --shadow-color: rgba(0,0,0,0.2);
                            --heading-font-size: 2rem;
                            --medium-font-size: 1.5rem;
                            --text-font-size: 1rem;

                            --font-family: 'Roboto', 'Arial, sans-serif';
                            --font-heading: 'Roboto', 'Helvetica Neue, sans-serif';
                        }
                        .card {
                            display: flex;
                            flex-direction: column;
                            width: 90%;
                            max-width: 700px;
                            background-color: var(--bar-color);
                            border: 1px solid var(--border-color);
                            border-radius: 12px;
                            padding: 1.5rem;
                            margin: 0 0 1rem 0;
                            box-shadow: 0 5px 20px var(--shadow-color);
                        }

                        .card h2 {
                            font-size: var(--medium-font-size);
                            margin: 0 0 1rem 0;
                        }

                        .card img {
                            width: 100%;
                            border-radius: 8px;
                            margin-bottom: 1rem;
                            border: 1px solid var(--border-color);
                        }

                        .card p {
                            font-size: 1rem;
                            line-height: 1.6;
                            margin-bottom: 1rem;
                            text-align: justify;
                            max-width: 100%;
                        }

                        .card .skills {
                            text-align: left;
                        }

                        .card a {
                            color: var(--text--color);
                            text-decoration: none;
                            word-break: break-all;
                        }

                        .card a:hover {
                            color: var(--text-hover-color);
                            transition: color 0.2s ease;
                        }

                        .delete-btn, .edit-btn {
                            color: var(--text-color);
                            background-color: var(--button-color);
                            border: 1px solid var(--border-color);
                            border-radius: 5px;
                            padding: .5em;
                            margin: 1em 0 0em 0;
                            font-size: 1em;
                            cursor: pointer;
                            transition: background-color 0.4s;
                        }

                        .delete-btn:hover, .edit-btn:hover {
                            background-color: var(--button-hover-color);
                        }
                    </style>
                    <div class="card">
                        <h2>${title}</h2>
                        <picture>
                            <source srcset="${imageSmall}" media="(max-width: 900px)">
                            <img src="${image}" alt="${alt}">
                        </picture>
                        <p><b>Skills:</b> ${skills}</p>
                        <p><b>Description:</b> ${description}</p>
                        <a href="${link}" target="_blank"><b>Link:</b> ${link}</a>
                        <button class="edit-btn">Edit</button>
                        <button class="delete-btn">Delete</button>
                    </div>
                `;

                // Delete card
                const deleteBtn = this.shadowRoot.querySelector('.delete-btn');
                deleteBtn.addEventListener('click', () => {
                    this.remove();

                    // Remove this project from localStorage
                    const projectData = JSON.parse(localStorage.getItem('crud-data')) || [];
                    const filtered = projectData.filter(proj =>
                        proj.title !== title || proj.description !== description
                    );
                    localStorage.setItem('crud-data', JSON.stringify(filtered));
                });

                // Edit card
                const editBtn = this.shadowRoot.querySelector('.edit-btn');
                editBtn.addEventListener('click', () => {
                    const dialog = document.getElementById('project-dialog');
                    const form = document.getElementById('project-form');

                    currentEditingCard = this;
        
                    // Populate form with current project info
                    form.title.value = title;
                    form.image.value = image;
                    form.alt.value = alt;
                    form.skills.value = skills;
                    form.description.value = description;
                    form.link.value = link;
        
                    dialog.showModal();
                });
            }
        }
        customElements.define('project-card', ProjectCard);

        // Fetch data and populate project cards
        document.addEventListener('DOMContentLoaded', async () => {
            const container = document.querySelector('#project-container');
            const newProjectBtn = document.getElementById('new-project-btn');
            const dialog = document.getElementById('project-dialog');
            const saveBtn = document.getElementById('save-project-btn');
            const cancelBtn = document.getElementById('cancel-project-btn');
            const loadLocalButton = document.getElementById('load-local');

            // Initialize crud-data if empty
            if (!localStorage.getItem('crud-data')) {
                localStorage.setItem('crud-data', JSON.stringify([]));
            }

            // Fetch projects from local storage
            function loadProjects() {
                container.innerHTML = '';
            
                const projectData = localStorage.getItem('crud-data');
                const projects = JSON.parse(projectData);
            
                projects.forEach((proj, index) => {
                    const card = document.createElement('project-card');
            
                    card.setAttribute('title', proj.title);
                    card.setAttribute('image', proj.image);
                    card.setAttribute('image-small', proj.imageSmall);
                    card.setAttribute('alt', proj.alt);
                    card.setAttribute('skills', proj.skills);
                    card.setAttribute('description', proj.description);
                    card.setAttribute('link', proj.link);
            
                    container.appendChild(card);
                });
            }

            // Create new project
            function newProject(e) {
                e.preventDefault();

                const form = document.getElementById('project-form');
                const dialog = document.getElementById('project-dialog');
            
                const projectData = JSON.parse(localStorage.getItem('crud-data')) || [];
            
                const newProj = {
                    title: form.title.value,
                    image: form.image.value,
                    imageSmall: form.image.value,
                    alt: form.alt.value,
                    skills: form.skills.value,
                    description: form.description.value,
                    link: form.link.value
                };
            
                // Editing old project
                if (currentEditingCard) {
                    const oldTitle = currentEditingCard.getAttribute('title');
                    const oldDescription = currentEditingCard.getAttribute('description');
            
                    const index = projectData.findIndex(proj =>
                        proj.title === oldTitle && proj.description === oldDescription
                    );
            
                    // Update crud data
                    projectData[index] = newProj;
                    localStorage.setItem('crud-data', JSON.stringify(projectData));
            
                    // Update card
                    currentEditingCard.setAttribute('title', newProj.title);
                    currentEditingCard.setAttribute('image', newProj.image);
                    currentEditingCard.setAttribute('image-small', newProj.imageSmall);
                    currentEditingCard.setAttribute('alt', newProj.alt);
                    currentEditingCard.setAttribute('skills', newProj.skills);
                    currentEditingCard.setAttribute('description', newProj.description);
                    currentEditingCard.setAttribute('link', newProj.link);
            
                    currentEditingCard = null;
                } 
                // New project
                else {
                    projectData.push(newProj);
                    localStorage.setItem('crud-data', JSON.stringify(projectData));
                }

                loadProjects();
            
                dialog.close();
                form.reset();
            };

            // Load projects from local storage
            loadLocalButton.addEventListener('click', loadProjects);

            // Add new project
            saveBtn.addEventListener('click', newProject);

            // Open new project dialog
            newProjectBtn.addEventListener('click', () => {
                dialog.showModal();
            });
        });

    </script>
  
    <noscript>
      <p><em>Note:</em> JavaScript is disabled â€” interactive features are unavailable.</p>
    </noscript>
  </body>
  </html>